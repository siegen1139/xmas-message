<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>3段スライド背景 Ver.7</title>
<style>
html, body { margin:0; padding:0; }
body { padding:20px; }

.bg {
  position: fixed;
  inset: 0;
  z-index: -1;
  background-color: #6b76ae;
  pointer-events: none;
  overflow: hidden;
  --row-height: 33.333vh; /* 画面高さの1/3 */
}

.row {
  position: absolute;
  left:0; right:0;
  height: var(--row-height);
  overflow: hidden;
}

.row1 { top:0; }
.row2 { top: var(--row-height); }
.row3 { top: calc(var(--row-height)*2); }

.belt {
  display: flex;
  align-items: center;
  gap: 0; /* JSで横間隔を設定 */
  will-change: transform;
}

.belt img {
  height: 99%;       /* 段に対して縦99% */
  width: auto;       /* 縦横比固定 */
  display: block;
  object-fit: contain;
}

main { position: relative; z-index:1; }

</style>
</head>
<body>

<div class="bg" aria-hidden="true">

  <div class="row row1">
    <div class="belt js-loop" data-dir="left">
      <img src="assets/row1/1.png">
      <img src="assets/row1/2.png">
      <img src="assets/row1/3.png">
    </div>
  </div>

  <div class="row row2">
    <div class="belt js-loop" data-dir="right">
      <img src="assets/row2/4.png">
      <img src="assets/row2/5.png">
    </div>
  </div>

  <div class="row row3">
    <div class="belt js-loop" data-dir="left">
      <img src="assets/row3/6.png">
      <img src="assets/row3/7.png">
      <img src="assets/row3/8.png">
    </div>
  </div>

</div>

<main>
  <h1>メッセージ Ver.7</h1>
  <p>3段背景スライド＋縦横比固定＋横間隔も余白対応</p>
</main>

<script>
// 全てのベルトを初期化
document.querySelectorAll('.js-loop').forEach(belt => {
  const row = belt.parentElement;
  const rowHeight = row.clientHeight;
  const verticalMargin = rowHeight * 0.01; // 上下余白1%
  
  // 画像間隔を設定
  const imgs = belt.querySelectorAll('img');
  imgs.forEach((img, i) => {
    img.style.height = rowHeight * 0.99 + 'px';
    if(i < imgs.length - 1){
      img.style.marginRight = verticalMargin + 'px';
    }
  });

  // ループアニメーション
  let x = 0;
  const dir = belt.dataset.dir === 'right' ? 1 : -1;
  const speed = 0.5; // px/frame
  const loop = () => {
    x += speed * dir;
    const w = belt.scrollWidth / 2; // 半分ループで戻す
    if(dir < 0 && -x >= w) x = 0;
    if(dir > 0 && x >= w) x = 0;
    belt.style.transform = `translateX(${x}px)`;
    requestAnimationFrame(loop);
  };

  // 複製してループ対応（画像が少なくてもつなぎ目なし）
  belt.innerHTML += belt.innerHTML;

  loop();
});
</script>

</body>
</html>
