
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ver.6.1.2</title>
  <!-- ver.6.1: 中段(row2)のみ「右から並べて右へ流す」に対応 -->
  <style>
    html, body { margin: 0; padding: 0; }
    body { padding: 20px; }

    .bg {
      position: fixed;
      inset: 0;
      z-index: -1;
      background-color: #6b76ae; /* 指定の背景色 */
      pointer-events: none;
      overflow: hidden;
      --row-height: 33.333vh; /* 画面を3等分 */
    }

    .row {
      position: absolute;
      left: 0;
      right: 0;
      height: var(--row-height);
      overflow: hidden;
      display: flex;
    }

    .row1 { top: 0; }
    .row2 { top: var(--row-height); }
    .row3 { top: calc(var(--row-height) * 2); }

    .belt {
      display: flex;
      align-items: center;
      will-change: transform;
    }

    /* ver.6.1 追加：右向きデータの帯は右から並べる */
    .belt[data-dir="right"] {
      flex-direction: row-reverse; /* 右端に最初の画像が来る並びにする */
    }

    .belt img {
      height: 99%;      /* 各段の高さに合わせてほぼいっぱいに */
      width: auto;      /* 縦横比を維持 */
      display: block;
      object-fit: contain;
    }

    main { position: relative; z-index: 1; }
  </style>
</head>
<body>

<div class="bg" aria-hidden="true">

  <!-- 1段目（左へ） -->
  <div class="row row1">
    <div class="belt js-loop" data-dir="left">
      <img src="assets/row1/1.png" alt="1">
      <img src="assets/row1/2.png" alt="2">
      <img src="assets/row1/3.png" alt="3">
      <img src="assets/row1/4.png" alt="4">
      <img src="assets/row1/5.png" alt="5">
    </div>
  </div>

  <!-- 2段目（右へ）※ver.6.1：右から並べて右へ流れる -->
  <div class="row row2">
    <div class="belt js-loop" data-dir="right" data-start="right">
      <img src="assets/row2/6.png" alt="6">
      <img src="assets/row2/7.png" alt="7">
      <img src="assets/row2/8.png" alt="8">
      <img src="assets/row2/9.png" alt="9">
      <img src="assets/row2/10.png" alt="10">
    </div>
  </div>

  <!-- 3段目（左へ） -->
  <div class="row row3">
    <div class="belt js-loop" data-dir="left">
      <img src="assets/row3/11.png" alt="11">
      <img src="assets/row3/12.png" alt="12">
      <img src="assets/row3/13.png" alt="13">
      <img src="assets/row3/14.png" alt="14">
      <img src="assets/row3/15.png" alt="15">
    </div>
  </div>

</div>

<main>
  <h1>背景調整中</h1>
  <p>ver.6.1.2</p>
</main>

<script>
/* === ver.6.1 スクリプト === */

// 画像高さを段の99%に統一（縦横比維持）
function updateImageSize() {
  document.querySelectorAll('.js-loop').forEach(belt => {
    const row = belt.parentElement;
    const rowHeight = row.clientHeight;
    belt.querySelectorAll('img').forEach(img => {
      img.style.height = (rowHeight * 0.99) + 'px';
    });
  });
}
updateImageSize();
window.addEventListener('resize', updateImageSize);

// ループ処理：画像を複製して2セット化し、1セット分(L)の範囲で移動してシームレス化
document.querySelectorAll('.js-loop').forEach(belt => {
  const dir = belt.dataset.dir === 'right' ? 1 : -1; // right=1, left=-1
  const duration = 40000; // ミリ秒（速度調整可）

    const start = belt.dataset.start || 'left'; // data-start="right" なら右端基準

  // 画像を複製（1セット + もう1セット）
  const originals = belt.querySelectorAll('img');
  originals.forEach(img => belt.appendChild(img.cloneNode(true)));

  const loop = () => {
    const t = (performance.now() % duration) / duration; // 0..1
    const L = belt.scrollWidth / 2;                       // 1セット分の長さ

       const vw = belt.parentElement.clientWidth;             // 表示領域の幅（row）
    
 let x;
    if (dir === -1) {
      // 左向き（そのまま）： 0 → -L
      x = -t * L;
    } else {
      // 右向き：開始位置を指定（left/right）
      // - left  基準： 0 から開始（従来）
      // - right 基準： 1周目の「右端」とビュー右端を一致（startX = -(L - vw)）
      const startX = (start === 'right') ? -(L - vw) : 0;
      const delta  =  t * L;     // 経過分の移動量（右へ）
      const raw    = startX + delta;

      // シームレス化：常に [-L, 0) にラップして継ぎ目を消す
      x = ((raw % L) + L) % L - L;
    }

    belt.style.transform = `translateX(${x}px)`;
    requestAnimationFrame(loop);
  };

  loop();

  // リサイズ時も綺麗に再計算
  window.addEventListener('resize', () => {
    requestAnimationFrame(loop);
  });
});
</script>

</body>
</html>
