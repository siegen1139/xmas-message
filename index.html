<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>スムーズループ背景</title>
<style>
  html, body { margin: 0; padding: 0; }
  body { padding: 20px; }

  .bg {
    position: fixed;
    inset: 0;
    z-index: -1;
    background-color: #6b76ae;
    pointer-events: none;
    overflow: hidden;
    --row-height: 33.333vh;
  }

  .row {
    position: absolute;
    left: 0;
    right: 0;
    height: var(--row-height);
    overflow: hidden;
    display: flex;
  }

  .row1 { top: 0; }
  .row2 { top: var(--row-height); }
  .row3 { top: calc(var(--row-height) * 2); }

  .belt {
    display: flex;
    align-items: center;
    will-change: transform;
  }

  .belt img {
    height: 99%;
    width: auto;
    display: block;
    object-fit: contain;
  }

  main { position: relative; z-index: 1; }
</style>
</head>
<body>

<div class="bg" aria-hidden="true">

  <!-- 1段目 -->
  <div class="row row1">
    <div class="belt js-loop" data-dir="left">
      <img src="assets/row1/1.png" alt="1">
      <img src="assets/row1/2.png" alt="2">
      <img src="assets/row1/3.png" alt="3">
      <img src="assets/row1/4.png" alt="4">
      <img src="assets/row1/5.png" alt="5">
    </div>
  </div>

  <!-- 2段目 -->
  <div class="row row2">
    <div class="belt js-loop" data-dir="right">
      <img src="assets/row2/6.png" alt="6">
      <img src="assets/row2/7.png" alt="7">
      <img src="assets/row2/8.png" alt="8">
      <img src="assets/row2/9.png" alt="9">
      <img src="assets/row2/10.png" alt="10">
    </div>
  </div>

  <!-- 3段目 -->
  <div class="row row3">
    <div class="belt js-loop" data-dir="left">
      <img src="assets/row3/11.png" alt="11">
      <img src="assets/row3/12.png" alt="12">
      <img src="assets/row3/13.png" alt="13">
      <img src="assets/row3/14.png" alt="14">
      <img src="assets/row3/15.png" alt="15">
    </div>
  </div>

</div>

<main>
  <h1>スムーズループ背景</h1>
  <p>どんなに横長のディスプレイでも余白なしでループします。</p>
</main>

<script>
// 画像高さを段の99%に統一
function updateImageSize() {
  document.querySelectorAll('.js-loop').forEach(belt => {
    const row = belt.parentElement;
    const rowHeight = row.clientHeight;
    belt.querySelectorAll('img').forEach(img => {
      img.style.height = rowHeight * 0.99 + 'px';
    });
  });
}
updateImageSize();
window.addEventListener('resize', updateImageSize);

// ループ処理（画像を繰り返す方式で修正）
document.querySelectorAll('.js-loop').forEach(belt => {
  const dir = belt.dataset.dir === 'right' ? 1 : -1;
  const duration = 40000;

  // 画像を複製して無限ループ
  const images = belt.querySelectorAll('img');
  images.forEach(img => belt.appendChild(img.cloneNode(true))); // 画像を複製

  // belt の幅を計算
  const updateBeltWidth = () => {
    let totalWidth = 0;
    belt.querySelectorAll('img').forEach(img => {
      totalWidth += img.offsetWidth; // 画像の合計幅を計算
    });
    belt.style.width = totalWidth + 'px'; // belt の幅を設定
  };
  
  updateBeltWidth();
  window.addEventListener('resize', updateBeltWidth);

  const loop = () => {
    const t = (performance.now() % duration) / duration;
    const scrollWidth = belt.scrollWidth / 2; // belt の実際の幅の半分
    const x = t * scrollWidth * dir; // スクロールする位置
    belt.style.transform = `translateX(${x}px)`; // 横移動させる

    requestAnimationFrame(loop); // アニメーションをループ
  };

  loop();
});
</script>

</body>
</html>
